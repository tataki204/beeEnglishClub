(()=>{let e;let t="PubxFloorProvider";(ee=K||(K={})).WIN="WIN",ee.FLOORED="FLOORED",ee.NOBIDS="NOBIDS",(et=X||(X={})).ERROR="ERROR",et.WARNING="WARNING";let o=()=>(()=>({splitRate:100,samplingRate:1,enableInstrumentationLogs:false,pbNsKeys:"pgPrebid",pbNamespace:null,currency:"BGN",modelVersion:"cb_AB_z_dt_0.75_dwt_1.0_dnt_0.1",auctionDelay:100,pubxId:"251fdff9-3043-42e6-a6f4-35500425a8a6",schema:['gptSlot','mediaType'],defaultValues:{'*|*':0.1627,'*|banner':0.1627,'/8095840,22029573691/.2_A.47410.7_test-english.com_tier1|banner':0.1625,'/8095840,22029573691/.2_A.47413.7_test-english.com_tier1|banner':0.1628,'/8095840,22029573691/.2_A.47414.3_test-english.com_tier1|banner':0.1629,'/8095840,22029573691/.2_A.47415.28_test-english.com_tier1|banner':0.1643},floorFetchUrl:"https://floor.pbxai.com/?pubxId=251fdff9-3043-42e6-a6f4-35500425a8a6&page="+window.location.href,floorMin:null,floorEnforcement:{"floorDeals":true},hbPbKey:"hb_pb",pubxSplitKey:"pubx-a",pubxSplitOnValue:"on",pubxSplitOffValue:"off",pubxOptimizedKey:"pubx-op",pubxOptimizedOnValue:"on",pubxOptimizedOffValue:"off",pubxABSplitAKey:"pubx-exp-A",pubxABSplitBKey:"pubx-exp-B",pubxMvKey:"pubx-m_v",pubxFloorKey:"pubx-floor",pubxFloorMvKey:"pubx-floor-mv",pubxExperiments:{}}))(),i=(e,t)=>{window[t]=window[t]||{},window[t].que=window[t].que||[],window[t].name=t,e.pbNamespace=window[t]},r=e=>({provider:"pubxai",options:{samplingRate:e.samplingRate,pubxId:e.pubxId}}),a=e=>{e.pbNamespace.que.push(function(){let{debug:t,error:o,remotePageError:i}=window.__pubx__.logger;if(!e.pbNamespace.installedModules.includes("pubxaiAnalyticsAdapter")){i({code:Y.PUBX_AA_NOT_FOUND});return}{let o=r(e);e.pbNamespace.enableAnalytics(o),t("Enabling Analytics",o)}})},n=e=>({floorProvider:t,modelVersion:e.modelVersion,currency:e.currency,schema:{fields:e.schema},values:e.defaultValues}),d=(e,o)=>{window.__pubxLoaded__&&e.pbNamespace.que.push(function(){let{debug:i,error:r,remotePageError:a}=window.__pubx__.logger;if(!e.pbNamespace.installedModules.includes("priceFloors")){a({code:Y.PRICE_FLOORS_NOT_FOUND});return}let n=e.pbNamespace.getConfig("floors");n&&n.data&&n.data.floorProvider&&n.data.floorProvider!==t&&a({code:Y.NON_PUBX_FLOORS_FOUND,payload:{existingFloors:n}});let d=o(e);window.__pubxFloorsConfig__=d,e.pbNamespace.setConfig(d),i("Setting Floors Config",d)})},s=(e,t)=>{let o=void 0!==e.adserverTargeting&&void 0!==e.adserverTargeting[t]&&!isNaN(e.adserverTargeting[t])&&parseFloat(e.adserverTargeting[t])>0;return o},l=(e,t)=>e.filter(e=>e.adUnitCode===t),u=(e,t)=>e.filter(e=>e.adUnitCode===t),c=(e,t)=>e.flatMap(e=>e.bids).filter(e=>e.adUnitCode===t),_=(e,t,o)=>0===e.length&&0===t.length?K.NOBIDS:e.some(e=>s(e,o))?K.WIN:K.FLOORED,p=(e,t,o,i,r,a)=>{try{if(void 0===e||"string"!=typeof t||"string"!=typeof o)throw Error(Y.CURRENCY_INVALID_INPUT);if(void 0===i.pbNamespace.convertCurrency)throw Error(Y.CURRENCY_MODULE_NOT_INSTALLED);if(t===o)return Number(e);return i.pbNamespace.convertCurrency(e,t,o)}catch(i){return a({code:Y.CURRENCY_INVALID_INPUT,adUnitCode:r,payload:{error:i,value:e,fromCurrency:t,toCurrency:o}}),Number(e)}},g=(e,t)=>[...e,...t],f=e=>{if(void 0!==e)return{floorValue:e.floorValue,floorRule:e.floorRule,floorCurrency:e.floorCurrency}},b=(e,t,o,i,r,a,n)=>{var d;let{remoteAucError:l,remoteAucEvent:u}=n,{hbPbKey:c}=a,_,b,m,O,R={};switch(r){case K.WIN:let E=t.filter(e=>s(e,c)).sort((e,t)=>parseFloat(t.adserverTargeting[c])-parseFloat(e.adserverTargeting[c]))[0];_=parseFloat(E.adserverTargeting[c]),m=E.currency,O=E.floorData,R=E.adserverTargeting;break;case K.FLOORED:let h=g(o,t),N=h.sort((t,o)=>p(o.originalCpm,o.originalCurrency,a.currency,a,e.code,l)-p(t.originalCpm,t.originalCurrency,a.currency,a,e.code,l))[0];_=N.originalCpm,m=N.originalCurrency,O=N.floorData,R=N.adserverTargeting||{};break;case K.NOBIDS:let A;if(m=window.__pubxFloorsConfig__?window.__pubxFloorsConfig__.floors.data.currency:a.currency,e2(e)){_=.01;break}let v=L(e.code);if(A=v?eX(v,window.__nextfloorsConfig__)||eX(v,window.__pubxFloorsConfig__):eK(e.code,window.__nextfloorsConfig__)||eK(e.code,window.__pubxFloorsConfig__)){_=A;break}window.__pubx__.logger.debug("NOBID floor rule not found for adUnit",e.code);let I=i.map(e=>{var t;if("function"!=typeof e.getFloor)return;let o=null===(t=e.getFloor({size:"*",mediaType:"banner"}))||void 0===t?void 0:t.floor;return"number"==typeof o&&o>=0?o:void 0}).filter(e=>void 0!==e);if(I.length>0){_=I.reduce((e,t)=>e+t,0)/I.length;break}window.__pubx__.logger.debug("NOBID getFloor() not found for adUnit",e.code),void 0!==a.defaultValues["*|banner"]?_=a.defaultValues["*|banner"]:(window.__pubx__.logger.debug("NOBID TAG_DEFAULT_VALUES_NOT_FOUND for adUnit",e.code),_=.01)}return T(a.pubxExperiments)&&(null===(d=window.__pubx__.abTestConfig)||void 0===d?void 0:d.isABTestEnabled)&&Object.assign(R,tt(a)),u({type:"pbBid",data:{adUnitCode:e.code,status:r,bidCurrency:m,bidValue:parseFloat(_.toFixed(4)),pubCurrency:a.currency,floorData:f(O),adserverTargeting:R}}),b=_,r===K.FLOORED&&(_=p(_,m,a.currency,a,e.code,l)),{bidCpmValue:parseFloat(_.toFixed(4)),originalBidCpmValue:parseFloat(b.toFixed(4)),bidCurrency:m,floorData:f(O),adserverTargeting:R}},m=(e,t,o,i)=>{var r,a,n,d;let{adUnitBidsReceived:s,adUnitBidsRejected:l,adUnitBidsFromBidderRequests:u}=y(e,t),c=t.auctionId,p=_(s,l,o.hbPbKey),g=null===(a=null===(r=u[0])||void 0===r?void 0:r.floorData)||void 0===a?void 0:a.floorProvider,f=null===(d=null===(n=u[0])||void 0===n?void 0:n.floorData)||void 0===d?void 0:d.modelVersion,m=e2(e),{bidCpmValue:O,originalBidCpmValue:R,bidCurrency:E,floorData:h,adserverTargeting:N}=b(e,s,l,u,p,o,i);return{auctionId:c,adUnit:e,adUnitStatus:p,bidCpmValue:O,originalBidCpmValue:R,bidCurrency:E,adserverTargeting:N,floorData:h,floorProvider:g,floorSkipStatus:m,floorModelVersion:f}},O=e=>e.adUnits.flatMap(e=>e.bids).map(e9).filter(e=>void 0!==e)[0],R=(e,t)=>{let o=e.bids.map(e9).filter(e=>void 0!==e)[0];if(void 0===o)throw t.remoteAucError({code:Y.MODEL_VERSION_NOT_FOUND_READ,adUnitCode:e.code}),Error(e_[Y.MODEL_VERSION_NOT_FOUND_READ].message+" for adUnit "+e.code);return o},E=e=>{let t=e.includes("_AB_")?e.split("_AB_")[1].split("_")[0]:void 0;return t},h=(e,t,o)=>{switch(o){case K.WIN:return e.includes("_dwt_")?parseFloat(e.split("_dwt_")[1].split("_")[0]):t.winBidMultiplier;case K.FLOORED:return e.includes("_dt_")?parseFloat(e.split("_dt_")[1].split("_")[0]):t.flooredBidMultiplier;case K.NOBIDS:return e.includes("_dnt_")?parseFloat(e.split("_dnt_")[1].split("_")[0]):t.noBidMultiplier}},N=(e,t,o)=>{if(e.includes("_fm_"))return parseFloat(e.split("_fm_")[1].split("_")[0]);if(!t.pmacFloorMultiplier)throw o({code:Y.PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG}),Error(e_[Y.PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG].message);return t.pmacFloorMultiplier},A=(e,t,o)=>{let i=void 0!==e.mediaTypes.banner,r=e.bids.some(e=>!!e.bidder),a=e4(e);if(!t&&a)throw o({code:Y.PUBX_OFF_FLOORS_FOUND,adUnitCode:e.code}),Error(e_[Y.PUBX_OFF_FLOORS_FOUND].message+" for adUnitCode "+e.code);return i&&r&&(!t&&!a||t&&a)},v=e=>e?e.filter(e=>!!e.originalCpm):[],I=(e,t,o,i)=>{let{remoteAucError:r}=i,{bidCpmValue:a,adUnitStatus:n,adUnit:d,auctionId:s}=e;ep({remoteError:r,code:Y.UNCAUGHT_ERROR,location:"triggerPmac"},()=>{e$(s,d.code,a,n,o,N(t,o,r),eP(t,o),i)}),d.code;let l=parseFloat((a*h(t,o,n)).toFixed(4));return e2(d)?void 0:{adUnitCode:d.code,floorValue:l,status:n}},y=(e,t)=>{let o=t.auctionId,i=l(t.bidsReceived,e.code),r=u(v(t.bidsRejected),e.code),a=c(t.bidderRequests,e.code);return{auctionId:o,adUnitBidsReceived:i,adUnitBidsRejected:r,adUnitBidsFromBidderRequests:a}},w=e=>e.type===X.ERROR&&e.arguments.length>0&&e.arguments[0].includes("Price Floors"),C=e=>{let t=e[0],o="";if(e.length>1)try{o=JSON.stringify(e[1])}catch(t){o=e[1]}window.__pubx__.logger.error("pubx: Price Floors Error",e),window.__pubx__.logger.remotePageError({code:Y.FLOORS_RESPONSE_INVALID,payload:{error:t,message:o}})},U=e=>{e.pbNamespace.que.push(()=>{e.pbNamespace.onEvent("auctionInit",t=>{!function(e,t){var o,i,r,a;o=this,i=void 0,r=void 0,a=function*(){let{debug:o,error:i}=window.__pubx__.logger,r=100/e.samplingRate/100;if(100*Math.random()<r&&function(){let e=localStorage.getItem("lastCallDate"),t=new Date().toLocaleDateString();return e!==t}()){o("Telemetry Triggered");let r=function(e,t){let o=[],[i,r]=function(e){try{let t=e.adUnits||[],o=new Set,i=[];return t.forEach(function(e){let t;let r=Object.keys(e.mediaTypes||{});if(e.mediaTypes.banner){let o=e.mediaTypes.banner;t=o.sizes.map(e=>e.join("x"))}else t=[];let a=L(e.code),n=a?a.getAdUnitPath()===e.code?a.getSlotElementId():a.getSlotElementId()===e.code?a.getAdUnitPath():"":"";i.push({code:e.code,sizes:t,gamSlot:n,media_type:r}),e.bids.forEach(function(e){o.add(e.bidder)})}),[{adUnits:i,bidders:Array.from(o)},null]}catch(t){let e="Error in getAdUnitAndBidders, reason:"+t.message;return[{adUnits:[],bidders:[]},e]}}(t);null!==r&&o.push(r);let[a,n]=function(e){try{let t={PubxaiAA:!!e.pbNamespace.installedModules.includes("pubxaiAnalyticsAdapter"),PriceFloors:!!e.pbNamespace.installedModules.includes("priceFloors"),PubxaiRTD:!!e.pbNamespace.installedModules.includes("pubxaiRtdProvider")};return[t,null]}catch(t){let e="Error in getPubxModuleStatus, reason:"+t.message;return[{},e]}}(e);null!==n&&o.push(n);let d=ev();return{pubx_id:e.pubxId,pbjs_version:e.pbNamespace.version||"",installed_modules:e.pbNamespace.installedModules.filter(e=>!e.includes("BidAdapter"))||[],ad_units:i.adUnits,bidders:i.bidders,pubx_modules_status:a,errors:o.length>0?o:null,timestamp:new Date().toISOString(),page_info:ef(d)}}(e,t);try{let e=navigator.sendBeacon("https://analytics.pbxai.com/telemetry",new Blob([JSON.stringify(r)],{type:"application/json"}));e?(localStorage.setItem("lastCallDate",new Date().toLocaleDateString()),o("Telemetry data sent successfully using sendBeacon",r)):o("Telemetry API call failed using sendBeacon")}catch(e){i("Telemetry API call failed due to an error:",e)}}},new(r||(r=Promise))(function(e,t){function n(e){try{s(a.next(e))}catch(e){t(e)}}function d(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var o;t.done?e(t.value):((o=t.value)instanceof r?o:new r(function(e){e(o)})).then(n,d)}s((a=a.apply(o,i||[])).next())})}(e,t=Object.assign({},t))});let t=e.pbNamespace.getEvents().filter(e=>"auctionDebug"===e.eventType).map(e=>e.args).filter(w);t.forEach(e=>C(e.arguments)),e.pbNamespace.onEvent("auctionDebug",e=>{w(e)&&C(e.arguments)})})},T=e=>!!e&&"number"==typeof(null==e?void 0:e.enforceJsSplit)&&e.enforceJsSplit>0,x=()=>(()=>({flooredBidMultiplier:0.75,noBidMultiplier:0.1,winBidMultiplier:1.0,pmacFloorMultiplier:0.5,decayRate:1.0,gamBuckets:[{'pbx_a0d_n':[0,0.03]},{'pbx_a1d_n':[0.03,0.06]},{'pbx_a2d_n':[0.06,0.09]},{'pbx_a3d_n':[0.09,0.12]},{'pbx_a4d_n':[0.12,0.15]},{'pbx_b0d_n':[0.15,0.2]},{'pbx_b1d_n':[0.2,0.25]},{'pbx_b2d_n':[0.25,0.3]},{'pbx_b3d_n':[0.3,0.35]},{'pbx_b4d_n':[0.35,0.4]},{'pbx_b5d_n':[0.4,0.45]},{'pbx_b6d_n':[0.45,0.5]},{'pbx_b7d_n':[0.5,0.55]},{'pbx_b8d_n':[0.55,0.6]},{'pbx_b9d_n':[0.6,0.65]},{'pbx_b10d_n':[0.65,0.7]},{'pbx_b11d_n':[0.7,0.75]},{'pbx_b12d_n':[0.75,0.8]},{'pbx_b13d_n':[0.8,0.85]},{'pbx_b14d_n':[0.85,0.9]},{'pbx_b15d_n':[0.9,0.95]},{'pbx_b16d_n':[0.95,1]},{'pbx_c0d_n':[1,1.1]},{'pbx_c1d_n':[1.1,1.2]},{'pbx_c2d_n':[1.2,1.3]},{'pbx_c3d_n':[1.3,1.4]},{'pbx_c4d_n':[1.4,1.5]},{'pbx_c5d_n':[1.5,1.6]},{'pbx_c6d_n':[1.6,1.7]},{'pbx_c7d_n':[1.7,1.8]},{'pbx_c8d_n':[1.8,1.9]},{'pbx_c9d_n':[1.9,2]},{'pbx_d0d_n':[2,2.25]},{'pbx_d1d_n':[2.25,2.5]},{'pbx_d2d_n':[2.5,2.75]},{'pbx_d3d_n':[2.75,3]},{'pbx_d4d_n':[3,3.25]},{'pbx_d5d_n':[3.25,3.5]},{'pbx_d6d_n':[3.5,3.75]},{'pbx_d7d_n':[3.75,4]},{'pbx_d8d_n':[4,4.25]},{'pbx_d9d_n':[4.25,4.5]},{'pbx_d10d_n':[4.5,4.75]},{'pbx_d11d_n':[4.75,5]},{'pbx_d12d_n':[5,111111]}]}))(),S=()=>{window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[]},D=e=>{let t=o();i(t,e);let r=x();return S(),Object.assign(Object.assign({},t),r)},F=(e,t)=>{let{error:o}=window.__pubx__.logger,i=googletag.pubads().getSlots(),r=[];return e.forEach(e=>{let t=i.find(t=>t.getAdUnitPath()===e||t.getSlotElementId()===e);void 0!==t&&r.push({adUnitCode:e,slot:t})}),r},P=(e,t,o,i,r,a,n="")=>{let{remoteAucEvent:d}=a;r.setTargeting(o,i),window.__pubx__.logger.debug("Setting KVs in GAM",n,{auctionId:e,adUnitCode:t,key:o,value:i,gptSlot:r}),d({type:"gamTargeting",data:{adUnitCode:t,[o]:i}})},L=e=>{if(!(null==googletag?void 0:googletag.pubads)||"function"!=typeof googletag.pubads)return;let t=googletag.pubads().getSlots().find(t=>t.getAdUnitPath()===e||t.getSlotElementId()===e);return t},M=(e,t,o)=>{let i=L(t);if(i){let r=i.getTargetingKeys().filter(e=>[o.pubxSplitKey,o.pubxOptimizedKey,o.pubxMvKey,o.pubxFloorKey,o.pubxFloorMvKey].includes(e));r.forEach(e=>{i.clearTargeting(e)}),window.__pubx__.logger.debug("Clearing KVs in GAM",{auctionId:e,adUnitCode:t,keys:r})}},B=(e,t,o,i,r)=>{let{remoteAucError:a}=r;googletag.cmd.push(()=>{ep({remoteError:a,code:Y.UNCAUGHT_GAM_ERROR,location:"setKeyGam"},()=>{let a=e.code;M(t,a,i);let{remoteAucError:n}=r,{__pubxGamQue__:d}=window,s=L(a);s?Object.entries(o).forEach(([e,o])=>{P(t,a,e,o,s,r)}):d.push({id:ev(),auctionId:t,adUnitCode:a,cmd:()=>{let e=L(a);return e?(Object.entries(o).forEach(([o,i])=>{P(t,a,o,i,e,r,"from QUE")}),!0):(n({code:Y.GAM_QUE_GPT_SLOT_NOT_FOUND,adUnitCode:a}),!1)},error:()=>{n({code:Y.GPT_SLOT_NOT_FOUND,adUnitCode:a})},logged:!1})})})},G=(e,t,o)=>{e.pbNamespace.que.push(()=>{e.pbNamespace.onEvent("auctionEnd",i=>{try{i=Object.assign({},i);let{makeRemoteAucError:r,makeRemoteAucEvent:a,error:n}=window.__pubx__.logger,d=r(i),s=a(i),l={remoteAucError:d,remoteAucEvent:s};ep({remoteError:d,code:Y.UNCAUGHT_ERROR,location:"readAndSetKvsAuction"},()=>{let{variant:r}=window.__pubx__,a=r.includes("STATIC"),n="PB_GAM_CUSTOM_MG"===r;(n||a)&&(window.__pubx__.logger.debug("pubx: setPubxLoadedFromAuctionData",n,a),window.__pubxLoaded__=i.adUnits.some(e4),window.__pubx__.logger.debug("pubx: window.__pubxLoaded__",window.__pubxLoaded__));let s=window.__pubxLoaded__;o&&(i=o(i,e,l)),i.adUnits.filter(e=>A(e,s,l.remoteAucError)).map(o=>{ep({remoteError:d,code:Y.UNCAUGHT_ERROR,location:"readAndSetKvsAdUnit"},()=>{var r;let a=te(o,e,l);T(e.pubxExperiments)&&(null===(r=window.__pubx__.abTestConfig)||void 0===r?void 0:r.isABTestEnabled)&&Object.assign(a,tt(e));let d=m(o,i,e,l);if(e4(o)){if(n){let t={vendor:"pubxai",auctionId:i.auctionId,transactionId:o.transactionId||ev(),billingId:ev(),type:"impression"};e.pbNamespace.rp.billableEvent(t),window.__pubx__.logger.debug("pubx: billable event raised for adUnit:",o.code,t)}let t=R(o,l);Object.assign(a,e3(t,e));let r=I(d,t,e,l);r&&Object.assign(a,e6(r,t,e,l.remoteAucError))}t&&t(o,i.auctionId,a,e,l)})})})}catch(e){window.__pubx__.logger.error(e)}})})},V=(e,t)=>{if(0===e)return t[0];let o=t.find(t=>{let o=Object.keys(t)[0],[i,r]=t[o];return e>i&&e<=r});return o},k=(e,t,o)=>{let i=V(e.floorValue,t.gamBuckets);if(void 0===i)throw o({code:Y.GAM_BUCKET_NOT_FOUND,adUnitCode:e.adUnitCode,payload:{floorWithStatus:e}}),Error(e_[Y.GAM_BUCKET_NOT_FOUND].message+" for "+JSON.stringify(e));let r=Object.keys(i)[0],a=e.status===K.WIN?"_w":e.status===K.FLOORED?"_f":"_n";return r.split("_n")[0]+a},j=e=>{e.pbNamespace.que.push(function(){let{error:e,remotePageError:t}=window.__pubx__.logger;googletag.cmd.push(()=>{googletag.pubads().addEventListener("slotAdded",e=>{ep({remoteError:t,code:Y.UNCAUGHT_GAM_ERROR,location:"setupEventHandlersForGamQue"},()=>{let t=e.slot,{__pubxGamQue__:o}=window,i=o.filter(e=>t&&(t.getAdUnitPath()===e.adUnitCode||t.getSlotElementId()===e.adUnitCode));i.forEach(e=>{if(e.cmd()){let t=o.findIndex(t=>t.id===e.id);t>-1&&o.splice(t,1)}})})})})})};(eo=H||(H={})).DBM_HEURISTICS="dbm_heuristics",eo.PMAC_DATA="pmac_data";let W=()=>{try{let e=[localStorage,sessionStorage];e.forEach(e=>{e.removeItem("pbx:dpbid"),e.removeItem("pubx:pmac"),e.removeItem("pubx:extraData")})}catch(e){console.error(e)}};var K,X,H,q,Y,z,J,Q,$,Z,ee,et,eo,ei,er,ea,en,ed,es,el,eu=function(e,t,o,i){return new(o||(o=Promise))(function(r,a){function n(e){try{s(i.next(e))}catch(e){a(e)}}function d(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(n,d)}s((i=i.apply(e,t||[])).next())})},ec=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)0>t.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(o[i[r]]=e[i[r]]);return o};(ei=q||(q={})).IN_PROGRESS="IN_PROGRESS",ei.SUCCESS="SUCCESS",ei.ERROR="ERROR",(er=Y||(Y={})).GPT_SLOT_NOT_FOUND="GPT_SLOT_NOT_FOUND",er.GAM_QUE_GPT_SLOT_NOT_FOUND="GAM_QUE_GPT_SLOT_NOT_FOUND",er.GAM_BUCKET_NOT_FOUND="GAM_BUCKET_NOT_FOUND",er.CALC_FLOOR_NOT_FOUND="CALC_FLOOR_NOT_FOUND",er.IMPROVEMEDIA_API_NOT_FOUND="IMPROVEMEDIA_API_NOT_FOUND",er.INVESTING_FILTER_NOT_FOUND="INVESTING_FILTER_NOT_FOUND",er.PUBX_AA_NOT_FOUND="PUBX_AA_NOT_FOUND",er.PRICE_FLOORS_NOT_FOUND="PRICE_FLOORS_NOT_FOUND",er.NON_PUBX_FLOORS_FOUND="NON_PUBX_FLOORS_FOUND",er.CURRENCY_INVALID_INPUT="CURRENCY_INVALID_INPUT",er.CURRENCY_MODULE_NOT_INSTALLED="CURRENCY_MODULE_NOT_INSTALLED",er.GET_FLOOR_NOT_FOUND="GET_FLOOR_NOT_FOUND",er.NO_BID_FLOOR_RULE_NOT_FOUND="NO_BID_FLOOR_RULE_NOT_FOUND",er.TAG_DEFAULT_VALUES_NOT_FOUND="TAG_DEFAULT_VALUES_NOT_FOUND",er.PUBX_OFF_FLOORS_FOUND="PUBX_OFF_FLOORS_FOUND",er.MODEL_VERSION_NOT_FOUND_READ="MODEL_VERSION_NOT_FOUND_READ",er.PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG="PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG",er.INVALID_SCHEMA_FIELDS_FLOORS_RESPONSE="INVALID_SCHEMA_FIELDS_FLOORS_RESPONSE",er.MISSING_ADUNIT_FLOOR_RESPONSE="MISSING_ADUNIT_FLOOR_RESPONSE",er.PMAC_FLOOR_RESPONSE_NOT_AVAILABLE="PMAC_FLOOR_RESPONSE_NOT_AVAILABLE",er.UNCAUGHT_ERROR="UNCAUGHT_ERROR",er.UNCAUGHT_GAM_ERROR="UNCAUGHT_GAM_ERROR",er.PUBX_ANALYTICS_ERROR="PUBX_ANALYTICS_ERROR",er.FLOORS_RESPONSE_INVALID="FLOORS_RESPONSE_INVALID",(ea=z||(z={})).INFO="INFO",ea.WARNING="WARNING",ea.ERROR="ERROR",ea.FATAL="FATAL";let e_={[Y.GPT_SLOT_NOT_FOUND]:{message:"GPT Slot not found",severity:z.WARNING},[Y.GAM_QUE_GPT_SLOT_NOT_FOUND]:{message:"Gam Que: GPT Slot not found",severity:z.ERROR},[Y.GAM_BUCKET_NOT_FOUND]:{message:"GAM Bucket not found",severity:z.WARNING},[Y.CALC_FLOOR_NOT_FOUND]:{message:"floorWithStatus not found",severity:z.FATAL},[Y.IMPROVEMEDIA_API_NOT_FOUND]:{message:"lwhbim.adServerKeywordsAdUnit is not defined",severity:z.ERROR},[Y.INVESTING_FILTER_NOT_FOUND]:{message:"window._imhb_auctions is not defined",severity:z.ERROR},[Y.PUBX_AA_NOT_FOUND]:{message:"pubxaiAnalyticsAdapter module is not installed",severity:z.WARNING},[Y.PRICE_FLOORS_NOT_FOUND]:{message:"priceFloors module is not installed",severity:z.WARNING},[Y.NON_PUBX_FLOORS_FOUND]:{message:"Non-pubx floor provider present",severity:z.WARNING},[Y.CURRENCY_INVALID_INPUT]:{message:"Invalid input types for currency conversion",severity:z.WARNING},[Y.CURRENCY_MODULE_NOT_INSTALLED]:{message:"currency module of prebid.js is not installed",severity:z.WARNING},[Y.GET_FLOOR_NOT_FOUND]:{message:"calc nbids - None of bidderRequests.bids.getFloor() is defined",severity:z.WARNING},[Y.NO_BID_FLOOR_RULE_NOT_FOUND]:{message:"calc nbids - Floor rule not found in __pubxFloorsConfig__ and __nextfloorsConfig__",severity:z.WARNING},[Y.TAG_DEFAULT_VALUES_NOT_FOUND]:{message:"defaultValues of *|banner in config is undefined",severity:z.ERROR},[Y.PUBX_OFF_FLOORS_FOUND]:{message:"pubxLoaded is false but has floorData",severity:z.FATAL},[Y.MODEL_VERSION_NOT_FOUND_READ]:{message:"floorModelVersion is undefined but adUnit.bids is not",severity:z.FATAL},[Y.PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG]:{message:"PMAC floor multiplier not found in config",severity:z.ERROR},[Y.INVALID_SCHEMA_FIELDS_FLOORS_RESPONSE]:{message:"Invalid schema fields in floor rules response, expected only ['gptSlot']",severity:z.ERROR},[Y.MISSING_ADUNIT_FLOOR_RESPONSE]:{message:"adUnitCode not found in floor rules response",severity:z.ERROR},[Y.PMAC_FLOOR_RESPONSE_NOT_AVAILABLE]:{message:"Floors Reponse not available for pmac",severity:z.WARNING},[Y.UNCAUGHT_ERROR]:{message:"Uncaught Error",severity:z.ERROR},[Y.UNCAUGHT_GAM_ERROR]:{message:"Uncaught GAM Error",severity:z.ERROR},[Y.PUBX_ANALYTICS_ERROR]:{message:"Pubx Analytics Error",severity:z.ERROR},[Y.FLOORS_RESPONSE_INVALID]:{message:"Floors Response Invalid",severity:z.ERROR}},ep=({remoteError:e,code:t,location:o},i)=>{try{i()}catch(i){window.__pubx__.logger.error(i),e({code:t,payload:{name:i.name,message:i.message,location:o}})}},eg=e=>{let{__pubx__:{variant:t,version:o}}=window;return{variant:t,version:o,loadTime:window.__loadTime__,pbVersion:e.pbNamespace.version,pbNamespace:e.pbNamespace.name}},ef=e=>({userAgent:navigator.userAgent,host:window.location.host,path:window.location.pathname,pageId:e,doNotTrack:navigator.doNotTrack}),eb=(e,t)=>e.pbNamespace.getEvents().filter(e=>"auctionEnd"===e.eventType).findIndex(e=>e.args.auctionId===t),em=e=>e.pbNamespace.getEvents().filter(e=>"auctionInit"===e.eventType).length,eO=e=>{let{code:t,adUnitCode:o,payload:i}=e,{message:r,severity:a}=e_[t];return{code:t,severity:a,message:r,adUnitCode:o,payload:i}},eR=(e,t,o,i)=>{let r=t;if(e.adUnitCode){let{adUnits:t,bidderRequests:o,bidsReceived:i,bidsRejected:a}=r;r=Object.assign(Object.assign({},r),{adUnits:t.filter(t=>t.code===e.adUnitCode),bidderRequests:o.map(t=>Object.assign(Object.assign({},t),{bids:t.bids.filter(t=>t.adUnitCode===e.adUnitCode)})),bidsReceived:i.filter(t=>t.adUnitCode===e.adUnitCode),bidsRejected:a?a.filter(t=>t.adUnitCode===e.adUnitCode):void 0})}let{auctionId:a,adUnits:n,bidderRequests:d,bidsReceived:s,bidsRejected:l}=r,u={adUnits:n.map(({code:e,sizes:t,bids:o,mediaTypes:i})=>({code:e,mediaTypes:Object.keys(i)})),bidderRequestsCount:d.length,bidsReceived:s.map(({adUnitCode:e,adserverTargeting:t,cpm:o,currency:i,originalCpm:r,originalCurrency:a,floorData:n})=>({adUnitCode:e,adserverTargeting:t?{hb_pb:t.hb_pb}:void 0,cpm:o,currency:i,originalCpm:r,originalCurrency:a,floorData:n?{floorValue:n.floorValue}:void 0})),bidsRejected:l?l.map(({adUnitCode:e,adserverTargeting:t,cpm:o,currency:i,originalCpm:r,originalCurrency:a,floorData:n})=>({adUnitCode:e,adserverTargeting:t?{hb_pb:t.hb_pb}:void 0,cpm:o,currency:i,originalCpm:r,originalCurrency:a,floorData:n?{floorValue:n.floorValue}:void 0})):void 0};return Object.assign({previousAuctionCount:eb(o,a),auctionId:a,auctionInfo:u,modelVersion:O(t)},eE(e,o,i))},eE=(e,t,o)=>({type:"error",isPubxEnabled:window.__pubxLoaded__,pubxId:t.pubxId,tagInfo:eg(t),pageInfo:ef(o),errorData:eO(e),timesince:Date.now()-window.__loadTimestamp__,timestamp:Date.now()}),eh=e=>{let t=e.pbNamespace.getConfig("floors");return t&&t.data&&t.data.floorProvider?t.data.floorProvider:void 0},eN=(e,t,o,i)=>{let{auctionId:r,adUnits:a,bidsReceived:n,bidsRejected:d,bidderRequests:s}=e,l={adUnitCount:a.length,bidCount:n.length+(d?d.length:0),bidders:[...new Set(s.map(({bidderCode:e})=>e))]};return{type:"event",isPubxEnabled:window.__pubxLoaded__,pubxId:t.pubxId,loadedBeforePb:window.__loadedBeforePb__,tagInfo:eg(t),floorProvider:eh(t),pageInfo:ef(i),missedAuctionCount:o,timesince:Date.now()-window.__loadTimestamp__,timestamp:Date.now(),previousAuctionCount:eb(t,r),auctionId:r,auctionInfo:l,modelVersion:O(e),pbBidData:[],gamTargetingData:[]}},eA=e=>{let{severity:t}=e_[e.code];return!1},ev=()=>{let e=new Date().getTime(),t="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){let i=16*Math.random();return e>0?(i=(e+i)%16|0,e=Math.floor(e/16)):(i=(t+i)%16|0,t=Math.floor(t/16)),("x"===o?i:3&i|8).toString(16)})},eI=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e),ey=()=>{window.__pubxGamQue__.filter(e=>!e.logged).forEach(e=>{e.error(),e.logged=!0})},ew=e=>{let t=[],o=[],i=[],r=em(e),a=ev(),n=e.enableInstrumentationLogs&&1/e.samplingRate>Math.random();window.__pubxLogsEnabled__=n;let d=e=>JSON.stringify(e).length,s=(e,t)=>{let o=[],i=0,r=[];for(let a of e){let e=d([a]);i+e>t?(r.push(o),o=[a],i=e):(o.push(a),i+=e)}return o.length>0&&r.push(o),r},l=(e,t)=>{0!==e.length&&s(e,65536).map(e=>{JSON.parse(JSON.stringify(e));let o=new Blob([JSON.stringify(e)],{type:"application/json"});navigator.sendBeacon(t,o)})},u=()=>!!navigator.sendBeacon&&!!document.visibilityState;u()&&document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&(ey(),l([...t,...o,...i],"https://analytics.pbxai.com/logs"),[t,o,i].map(e=>e.splice(0)))});let c=window.location.search,_=new URLSearchParams(c),p=(...e)=>{e=e.filter(e=>void 0!==e),_.has("pubx_debug")&&console.error("%cPubx.ai","background-color: #fc6203; color: white; border-radius: 3px; padding: 1px 4px","ERROR:",...e)};return{debug:(e,...t)=>{_.has("pubx_debug")&&console.info("%cPubx.ai","background-color: #fc6203; color: white; border-radius: 3px; padding: 1px 4px","INFO:",e,...t)},error:p,makeRemoteAucError:o=>i=>{let{code:r,adUnitCode:d,payload:s}=i;p(e_[r].message,d,s),u()&&(n||eA(i))&&t.push(eR(i,o,e,a))},remotePageError:t=>{let{code:i,adUnitCode:r,payload:d}=t;p(e_[i].message,r,d),u()&&(n||eA(t))&&o.push(eE(t,e,a))},makeRemoteAucEvent:t=>{let o=(o,i)=>{let n=i.find(e=>e.auctionId===t.auctionId);if(void 0===n&&(n=eN(t,e,r,a),i.push(n)),"pbBid"===o.type)n.pbBidData.push(o.data);else if("gamTargeting"===o.type){let e=o.data,t=n.gamTargetingData.find(t=>t.adUnitCode===e.adUnitCode);void 0===t?n.gamTargetingData.push(e):Object.assign(t,e)}};return e=>{u()&&n&&o(e,i)}}}},eC=e=>{window.__pubx__.logger.debug("version:",window.__pubx__.variant+"_"+window.__pubx__.version+"_"+e.name)},eU=()=>{window.__loadTime__=window.__loadTimestamp__?Date.now()-window.__loadTimestamp__:-1,window.__loadTimestamp__=Date.now()},eT=(e,t)=>{let o=window.__pubxFloorsConfig__.floors,{auctionDelay:i,endpoint:r,data:a}=o,n=ec(o,["auctionDelay","endpoint","data"]);window.__nextfloorsConfig__={floors:Object.assign(Object.assign({},n),{data:e})}},ex=(e,t)=>{let o=t.pbNamespace.getConfig("floors"),{auctionDelay:i,endpoint:r,data:a}=o,n=ec(o,["auctionDelay","endpoint","data"]);window.__nextfloorsConfig__={floors:Object.assign(Object.assign({},n),{data:e})}},eS=e=>window.__pmacCpmHistory__[e],eD=e=>{let t=eS(e);return t?t.history:[]},eF=(e,t,o,i)=>{let{debug:r}=window.__pubx__.logger,{__pmacCpmHistory__:a}=window;void 0===a[t]&&(a[t]={history:[],decayRate:void 0});let n={auctionId:e,cpm:o,adUnitStatus:i};eD(t).push(n),r("Update Pmac history",t,n)},eP=(e,t)=>{let{debug:o}=window.__pubx__.logger;return e.includes("_dr_")?-1*parseFloat(e.split("_dr_")[1].split("_")[0]):null!==t.decayRate?-1*t.decayRate:(o("No decay rate in floor model version or config",e),null)},eL=(e,t,o)=>(e=0===e?.01:e)*Math.exp(t*o),eM=(e,t)=>{let{debug:o}=window.__pubx__.logger,i=eS(e);i.decayRate=t,o("Assigning decay rate",e,i.decayRate)},eB=e=>{let t=eD(e);return 0!==t.length},eG=(e,t)=>{let{remoteAucError:o}=t,{__pmacCpmHistory__:i}=window,r=Object.keys(i);if("PB_GAM_CUSTOM_AY"===window.__pubx__.variant)r.forEach(o=>{eB(o)&&eH(o,void 0,eq(o,e),t)});else{let i=F(r,o);i.forEach(({adUnitCode:o,slot:i})=>{eB(o)&&eH(o,i,eq(o,e),t)})}},eV=e=>"|banner"+(e.fields.includes("size")?"|*":""),ek=(e,t,o)=>{let i=Object.keys(t),r=eV(o),a=i.find(t=>[e.getAdUnitPath()+r,e.getSlotElementId()+r].includes(t));return a},ej=(e,t,o)=>{let i=Object.keys(t),r=i.find(t=>t.split(eV(o))[0]===e);return r},eW=(e,t,o)=>{let i=Object.keys(t),r=i.find(t=>t.split(eV(o))[0]===to(e));return r},eK=(e,t)=>{if(t){let o=ej(e,t.floors.data.values,t.floors.data.schema);if(o)return t.floors.data.values[o]}},eX=(e,t)=>{if(t){let o=ek(e,t.floors.data.values,t.floors.data.schema);if(o)return t.floors.data.values[o]}},eH=(e,t,o,i)=>{let r;let{remoteAucError:a}=i,{__nextfloorsConfig__:n}=window;if(void 0===n)throw Error("__nextfloorsConfig__ undefined. Skip updating adUnit floors config");let{floors:{data:{values:d,schema:s}}}=n;if(void 0===(r="PB_GAM_CUSTOM_AY"===window.__pubx__.variant?eW(e,d,s):ek(t,d,s))){a({code:Y.MISSING_ADUNIT_FLOOR_RESPONSE,adUnitCode:e});return}d[r]=o},eq=(e,t)=>{let{decayRate:o,history:i}=eS(e),[r,a]=[i[0].cpm,i.length],n=eL(r,o,a),d=n*t;return d<.01?.01:parseFloat(d.toFixed(4))},eY=(e,t)=>eu(void 0,void 0,void 0,function*(){let{debug:t}=window.__pubx__.logger;try{let o=yield fetch(e.floorFetchUrl),i=yield o.json();t("PMAC Received floor rules",i),eT(i,e)}catch(i){let o=n(e);t("PMAC Default floor rules",o),eT(o,e)}}),ez=(e,t)=>eu(void 0,void 0,void 0,function*(){let{debug:t}=window.__pubx__.logger;try{let o=yield fetch(e.floorFetchUrl),i=yield o.json();t("PMAC Received floor rules",i),ex(i,e)}catch(i){let o=n(e);t("PMAC Default floor rules",o),ex(o,e)}}),eJ=(e,t)=>eu(void 0,void 0,void 0,function*(){let{debug:t}=window.__pubx__.logger,o=e.pbNamespace.getConfig("floors");window.__nextfloorsConfig__={floors:o},t("Reading floors from config",o)}),eQ=()=>eu(void 0,void 0,void 0,function*(){let e=()=>{let{debug:e}=window.__pubx__.logger,t=window.__pubxFloorsConfig__;if(!t)throw Error("__pubxFloorsConfig__ not defined. Skip pmac");window.__nextfloorsConfig__=t,e("Reading floors from rtd module",t)};e(),window.addEventListener("floorsApi",t=>{t.detail.status===q.SUCCESS&&e()})}),e$=(e=null,(t,o,i,r,a,n,s,l)=>eu(void 0,void 0,void 0,function*(){let{remoteAucError:u}=l,{variant:c,isRtd:_}=window.__pubx__;if(null===s){window.__pubx__.logger.debug("pubx: PMAC Turned off");return}null===e&&(e=_?eQ():"PB_GAM_CUSTOM_AZ"===c?eJ(a,l):"PB_GAM_CUSTOM_MG"==c||c.includes("STATIC")?ez(a,l):eY(a,l)),yield e,window.__pubx__.logger.debug("pubx:","triggering pmac"),eF(t,o,i,r),eM(o,s);let{__nextfloorsConfig__:p}=window;if(void 0===p)throw u({code:Y.PMAC_FLOOR_RESPONSE_NOT_AVAILABLE,adUnitCode:o}),Error("__nextfloorsConfig__ undefined. Skip updating floors config");"PB_GAM_CUSTOM_AY"===c?(eG(n,l),d(a,e=>p)):googletag.cmd.push(()=>{ep({remoteError:u,code:Y.UNCAUGHT_GAM_ERROR,location:"updateSetFloor"},()=>{eG(n,l),d(a,e=>p)})})})),eZ=()=>({debug:(e,...t)=>{},error:(...e)=>{},makeRemoteAucError:e=>e=>{},remotePageError:e=>{},makeRemoteAucEvent:e=>e=>{}}),e0=(e,t)=>{W(),window.__pubxFloors__={},!1!==window.__loadedBeforePb__&&(window.__loadedBeforePb__=void 0===e.pbNamespace.version),window.__pmacCpmHistory__={},eU(),window.__pubx__={variant:t,version:"1744874877299",isRtd:!1},window.__pubx__.logger||(window.__pubx__.logger=eZ()),window.__pubxLoaded__&&T(e.pubxExperiments)&&ti(e.pubxExperiments.enforceJsSplit)&&(window.__pubx__.abTestConfig={isABTestEnabled:!0,testBucket:50>100*Math.random()?"A":"B"}),e.pbNamespace.que.push(function(){window.__pubx__.logger=ew(e),eC(e.pbNamespace)}),window.__pubxGamQue__=[]},e1=e=>e0(e,"PB_GAM_CUSTOM_AZ"),e2=e=>e.bids.some(({floorData:e})=>e&&e.floorProvider===t&&e.skipped),e9=e=>{let{floorData:o}=e;if(o&&o.floorProvider===t&&o.modelVersion)return o.modelVersion},e4=e=>e.bids.some(e9),e3=(e,t)=>{let o={},i=E(e);return i&&(o[t.pubxMvKey]=i),o},e6=(e,t,o,i)=>{let r={},a=k(e,o,i);r[o.pubxFloorKey]=a;let n=E(t);if(n){let e=e5(a,n);r[o.pubxFloorMvKey]=e}return r},e5=(e,t)=>e+"-"+t,e7=(e,t)=>{let o=e2(e);return o?t.pubxOptimizedOffValue:t.pubxOptimizedOnValue},e8=(e,t)=>{let o=e4(e);return o?t.pubxSplitOnValue:t.pubxSplitOffValue},te=(e,t,o)=>{let i={},r=e8(e,t);if(i[t.pubxSplitKey]=r,r===t.pubxSplitOnValue){let r=R(e,o),a=t.modelVersion===r;a||(i[t.pubxOptimizedKey]=e7(e,t))}return i},tt=e=>{var t;let o={},i={enforceJSOn:"f_enf_on",enforceJSOff:"f_enf_off"},r=null===(t=window.__pubx__.abTestConfig)||void 0===t?void 0:t.testBucket,a="A"===r?e.pubxABSplitAKey:e.pubxABSplitBKey,n="A"===r?i.enforceJSOn:i.enforceJSOff;return o[a]=n,o},to=e=>e.split("__ayManagerEnv__")[0],ti=e=>e>100*Math.random();var tr={};function ta(e){return e[0]+"x"+e[1]}function tn(e){return Array.isArray(e)&&2===e.length&&!isNaN(e[0])&&!isNaN(e[1])}tr=function(e,t,o,i,r){for(t=t.split?t.split("."):t,i=0;i<t.length;i++)e=e?e[t[i]]:r;return e===r?o:e};let td=(e,t)=>e.getAdUnitPath()===t||e.getSlotElementId()===t;function ts(e){let t;if(window.googletag&&"function"==typeof window.googletag.pubads&&"function"==typeof window.googletag.pubads().getSlots){let o=window.googletag.pubads().getSlots();t=o.find(t=>td(t,e))}return t}function tl(e){var t;let o=null===(t=window.__pubx__)||void 0===t?void 0:t.logger;try{let t=ts(e);if(t)return{gptSlot:t.getAdUnitPath(),divId:t.getSlotElementId()};return{}}catch(e){return null==o||o.error("getGptSlotInfoForAdUnitCode error:",e),null==o||o.remotePageError({code:Y.UNCAUGHT_ERROR,payload:{name:e.name,message:e.message}}),{}}}(en=J||(J={}))[en.DESKTOP=0]="DESKTOP",en[en.MOBILE=1]="MOBILE",en[en.TABLET=2]="TABLET",(ed=Q||(Q={}))[ed.CHROME=0]="CHROME",ed[ed.FIREFOX=1]="FIREFOX",ed[ed.SAFARI=2]="SAFARI",ed[ed.EDGE=3]="EDGE",ed[ed.INTERNET_EXPLORER=4]="INTERNET_EXPLORER",ed[ed.OTHER=5]="OTHER",(es=$||($={}))[es.WINDOWS=0]="WINDOWS",es[es.MAC=1]="MAC",es[es.LINUX=2]="LINUX",es[es.UNIX=3]="UNIX",es[es.IOS=4]="IOS",es[es.ANDROID=5]="ANDROID",es[es.OTHER=6]="OTHER";let tu=()=>{try{if(/ipad|android 3.0|xoom|sch-i800|playbook|tablet|kindle/i.test(navigator.userAgent.toLowerCase()))return J.TABLET;if(/iphone|ipod|android|blackberry|opera|mini|windows\sce|palm|smartphone|iemobile/i.test(navigator.userAgent.toLowerCase()))return J.MOBILE;return J.DESKTOP}catch(e){return J.DESKTOP}},tc=()=>{try{if(/Edg/.test(navigator.userAgent))return Q.EDGE;if(/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))return Q.CHROME;if(navigator.userAgent.match("CriOS"))return Q.CHROME;if(/Firefox/.test(navigator.userAgent))return Q.FIREFOX;else if(/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor))return Q.SAFARI;else if(/Trident/.test(navigator.userAgent)||/MSIE/.test(navigator.userAgent))return Q.INTERNET_EXPLORER;else return Q.OTHER}catch(e){return Q.OTHER}},t_=()=>{try{if(-1!=navigator.userAgent.indexOf("Android"))return $.ANDROID;if(-1!=navigator.userAgent.indexOf("like Mac"))return $.IOS;if(-1!=navigator.userAgent.indexOf("Win"))return $.WINDOWS;if(-1!=navigator.userAgent.indexOf("Mac"))return $.MAC;if(-1!=navigator.userAgent.indexOf("Linux"))return $.LINUX;if(-1!=navigator.appVersion.indexOf("X11"))return $.UNIX;return $.OTHER}catch(e){return $.OTHER}};(el=Z||(Z={})).BID_TIMEOUT="bidTimeout",el.BID_RESPONSE="bidResponse",el.BID_REJECTED="bidRejected",el.AUCTION_END="auctionEnd",el.BID_WON="bidWon";let tp=[Z.BID_TIMEOUT,Z.BID_RESPONSE,Z.BID_REJECTED,Z.AUCTION_END,Z.BID_WON];class tg{constructor(e,t,o){var i;this.auctionCache={},this.auctionRankCounter=0,this.auctionIdMap=new Map,this.auctionRankMap=new Map,window.__pubx__=window.__pubx__||{},window.__pubx__.analytics={auctionCache:this.auctionCache,auctionIdMap:this.auctionIdMap},this.initOptions=Object.assign({samplingRate:1},e),this.config=o,this.prebidInstance=t,this.logger=null===(i=window.__pubx__)||void 0===i?void 0:i.logger}getWindowLocation(){var e;try{return(null===(e=window.top)||void 0===e?void 0:e.location)||window.location}catch(e){return this.logger.error("PubxAnalytics getWindowLocation error:",e),this.logger.remotePageError({code:Y.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}}),window.location}}getAdServerDataForBid(e){try{let t=(null==e?void 0:e.adUnitCode)||"",o=ts(t);if(o)return Object.fromEntries(o.getTargetingKeys().filter(e=>e.startsWith("pubx-")||e.startsWith("hb_")&&1===(e.match(/_/g)||[]).length).map(e=>[e,o.getTargeting(e)]));return{}}catch(e){return this.logger.error("PubxAnalytics getAdServerDataForBid error:",e),this.logger.remotePageError({code:Y.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}}),{}}}extractBid(e){var t;return{auctionId:this.getAuctionId(e.auctionId),adUnitCode:e.adUnitCode,gptSlotCode:tl(e.adUnitCode).gptSlot||null,bidderCode:e.bidder,cpm:e.cpm,originalCpm:e.originalCpm,originalCurrency:e.originalCurrency,creativeId:e.creativeId,dealId:e.dealId,currency:e.currency,floorData:e.floorData,mediaType:e.mediaType,netRevenue:e.netRevenue,requestTimestamp:e.requestTimestamp,responseTimestamp:e.responseTimestamp,status:e.status,sizes:(function(e){var t;let o=null===(t=window.__pubx__)||void 0===t?void 0:t.logger;try{return("string"==typeof e?e.split(/\s*,\s*/).map(e=>e.match(/^(\d+)x(\d+)$/i)).filter(e=>null!==e).map(([e,t,o])=>[parseInt(t,10),parseInt(o,10)]):Array.isArray(e)?tn(e)?e.filter(tn):[e]:[]).map(ta)}catch(e){return null==o||o.error("parseSizesInput error:",e),null==o||o.remotePageError({code:Y.UNCAUGHT_ERROR,payload:{name:e.name,message:e.message}}),[]}})(e.size).toString(),statusMessage:e.statusMessage,timeToRespond:e.timeToRespond,transactionId:e.transactionId,bidId:e.bidId||e.requestId,placementId:e.params?((t=tr)&&t.__esModule?t.default:t)(e,"params.0.placementId"):null,source:e.source||"null"}}getAuctionId(e){try{if(!e)throw Error(`Missing auctionId(${e})provided to PubxAnalytics in bidResponse`);if(e&&"string"==typeof e&&eI(e))return e;if(e&&this.auctionIdMap.has(e))return this.auctionIdMap.get(e);let t=ev();return this.auctionIdMap.set(e,t),this.logger.debug("Generated new auctionId for invalid auctionId",{originalId:e,generatedId:t}),t}catch(t){if(this.logger.error("PubxAnalytics getAuctionId error:",t),this.logger.remotePageError({code:Y.PUBX_ANALYTICS_ERROR,payload:{name:t.name,message:t.message}}),!e)return ev();return e}}track(e,t){try{switch(e){case Z.BID_TIMEOUT:t.map(this.extractBid.bind(this)).forEach(e=>{e.bidType=3,this.addBidToCache(e)});break;case Z.BID_RESPONSE:let o=Object.assign(this.extractBid(t),{bidType:2});this.addBidToCache(o);break;case Z.BID_REJECTED:let i=Object.assign(this.extractBid(t),{bidType:1});this.addBidToCache(i);break;case Z.AUCTION_END:this.processAuctionEnd(t);break;case Z.BID_WON:this.processBidWon(t)}}catch(e){this.logger.error("PubxAnalytics track error:",e),this.logger.remotePageError({code:Y.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}})}}getConsentMetadata(){var e,t;try{return(null===(t=(e=this.prebidInstance).getConsentMetadata)||void 0===t?void 0:t.call(e))||{}}catch(e){return this.logger.error("PubxAnalytics getConsentMetadata error:",e),this.logger.remotePageError({code:Y.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}}),{}}}getUserIds(){var e,t;try{return(null===(t=(e=this.prebidInstance).getUserIds)||void 0===t?void 0:t.call(e))||{}}catch(e){return this.logger.error("PubxAnalytics getUserIds error:",e),this.logger.remotePageError({code:Y.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}}),{}}}addBidToCache(e){this.auctionCache[e.auctionId]||this.initializeAuctionCache(e.auctionId),this.auctionCache[e.auctionId].bids.push(e)}initializeAuctionCache(e){var t;let o=++this.auctionRankCounter;this.auctionRankMap.set(o,e),this.auctionCache[e]={bids:[],winningBids:[],auctionDetail:{auctionRank:o,auctionId:e,previousAuctionId:this.auctionRankMap.get(o-1)||null},floorDetail:{},adUnitDetails:[],pageDetail:{host:this.getWindowLocation().host,path:this.getWindowLocation().pathname,search:this.getWindowLocation().search},deviceDetail:{platform:navigator.platform,deviceType:tu(),deviceOS:t_(),browser:tc()},userDetail:{userIdTypes:Object.keys(this.getUserIds())},consentDetail:{consentTypes:Object.keys(this.getConsentMetadata())},pmacDetail:{pmac_data:[]},extraData:(null===(t=window.__pubx__)||void 0===t?void 0:t.extraData)||{},initOptions:Object.assign(Object.assign({},this.initOptions),{auctionId:e}),sendAs:[]}}collectAuctionAdunitData(e){try{let t=this.getAuctionId(e.auctionId),o=e.bidderRequests,i=e.adUnits,r=new Map;for(let e of i){let t=e.code,o=Object.entries(e.mediaTypes||{}).reduce((e,[t,o])=>("video"===t&&(null==o?void 0:o.context)?e.push(`video:${o.context}`):e.push(t),e),[]);r.set(t,{adunitCode:t,gptSlotCode:tl(t).gptSlot||null,mediaTypes:o,bidders:[],refreshRank:void 0})}for(let e of o)for(let t of e.bids){if(!t.adUnitCode){this.logger.error("PubxAnalytics collectAuctionAdunitData error: Missing adUnitCode in bidderRequest",{bidderRequest:e});continue}let o=r.get(t.adUnitCode);o&&(o.bidders.push(t.bidder),o.refreshRank=t.auctionsCount||t.bidRequestsCount||void 0),r.set(t.adUnitCode,o)}this.auctionCache[t].adUnitDetails=Array.from(r.values())}catch(e){this.logger.error("PubxAnalytics collectAuctionAdunitData error:",e),this.logger.remotePageError({code:Y.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}})}}collectAndStoreAuctionFeedbackData(e,t){try{let o=this.getAuctionId(e.auctionId),i=this.logger.makeRemoteAucError(e),r=this.logger.makeRemoteAucEvent(e),a={remoteAucError:i,remoteAucEvent:r},n=[];e.adUnits.forEach(i=>{let r=m(i,e,t,a),{adUnitStatus:d,originalBidCpmValue:s,bidCurrency:l,adserverTargeting:u,floorData:c,floorProvider:_,floorSkipStatus:p,floorModelVersion:g}=r,b={auctionId:o,auctionRank:this.auctionRankCounter,adUnitCode:i.code,status:d,bidCurrency:l,bidValue:s,pubCurrency:t.currency,adserverTargeting:u,floorData:f(c),floorProvider:_,floorSkipStatus:p,floorModelVersion:g};n.push(b)}),Object.assign(this.auctionCache[o].pmacDetail,{pmac_data:n})}catch(r){this.logger.error("PubxAnalytics collectAndStoreAuctionFeedbackData error:",r),this.logger.remotePageError({code:Y.PUBX_ANALYTICS_ERROR,payload:{name:r.name,message:r.message}});let o=this.getAuctionId(e.auctionId),i=e.adUnits.map(e=>({auctionId:o,auctionRank:this.auctionRankCounter,adUnitCode:e.code,pubCurrency:t.currency}));Object.assign(this.auctionCache[o].pmacDetail,{pmac_data:i})}}processAuctionEnd(e){var t,o;try{let i=this.getAuctionId(e.auctionId);this.auctionCache[i]||this.initializeAuctionCache(i),Object.assign(this.auctionCache[i].floorDetail,(null===(t=e.adUnits)||void 0===t?void 0:t.map(e=>{var t,o;return(null===(t=null==e?void 0:e.bids)||void 0===t?void 0:t.length)&&(null===(o=e.bids[0])||void 0===o?void 0:o.floorData)}).find(e=>e))||{}),this.auctionCache[i].deviceDetail.cdep=e.bidderRequests.map(e=>{var t,o,i;return null===(i=null===(o=null===(t=e.ortb2)||void 0===t?void 0:t.device)||void 0===o?void 0:o.ext)||void 0===i?void 0:i.cdep}).find(e=>e),Object.assign(this.auctionCache[i].auctionDetail,{adUnitCodes:(null===(o=e.adUnits)||void 0===o?void 0:o.map(e=>e.code))||[],timestamp:e.timestamp}),this.collectAndStoreAuctionFeedbackData(e,this.config),this.collectAuctionAdunitData(e),this.prepareAuctionSend(i)}catch(e){this.logger.error("PubxAnalytics processAuctionEnd error:",e),this.logger.remotePageError({code:Y.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}})}}processBidWon(e){try{let t=this.extractBid(e);this.auctionCache[t.auctionId]||this.initializeAuctionCache(t.auctionId);let o=this.auctionCache[t.auctionId].floorDetail;Object.assign(t,{floorProvider:(null==o?void 0:o.floorProvider)||null,floorFetchStatus:(null==o?void 0:o.fetchStatus)||null,floorLocation:(null==o?void 0:o.location)||null,floorModelVersion:(null==o?void 0:o.modelVersion)||null,floorSkipRate:(null==o?void 0:o.skipRate)||0,isFloorSkipped:(null==o?void 0:o.skipped)||!1,isWinningBid:!0,renderedSize:e.size,bidType:4,adServerData:this.getAdServerDataForBid(t)}),this.auctionCache[t.auctionId].winningBids.push(t),this.prepareSendWinningBids(t)}catch(e){this.logger.error("PubxAnalytics processBidWon error:",e),this.logger.remotePageError({code:Y.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}})}}shouldFireEventRequest(e=""){var t;try{let o=null!==(t=this.initOptions.samplingRate)&&void 0!==t?t:1;return parseInt(function(e,t=0){let o=function(e,t){if("function"==typeof Math.imul)return Math.imul(e,t);var o=(4194303&e)*(t|=0);return 4290772992&e&&(o+=(4290772992&e)*t|0),0|o},i=3735928559^t,r=1103547991^t;for(let t=0,a;t<e.length;t++)i=o(i^(a=e.charCodeAt(t)),2654435761),r=o(r^a,1597334677);return i=o(i^i>>>16,2246822507)^o(r^r>>>13,3266489909),(4294967296*(2097151&(r=o(r^r>>>16,2246822507)^o(i^i>>>13,3266489909)))+(i>>>0)).toString()}(e))%o==0}catch(e){return this.logger.error("PubxAnalytics shouldFireEventRequest error:",e),this.logger.remotePageError({code:Y.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}}),!1}}prepareSendWinningBids(e){try{let{auctionId:t}=e;if(!this.shouldFireEventRequest(t))return;let o=Object.assign({},this.auctionCache[t]);o.winningBid=e;let i={path:tg.winningBidPath,requiredKeys:["winningBid","pageDetail","deviceDetail","floorDetail","auctionDetail","userDetail","consentDetail","pmacDetail","extraData","initOptions"],eventType:"win"};this.sendData(i,o)}catch(e){this.logger.error("PubxAnalytics prepareSendWinningBids error:",e),this.logger.remotePageError({code:Y.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}})}}prepareAuctionSend(e){try{if(!this.shouldFireEventRequest(e))return;let t=Object.assign({},this.auctionCache[e]),o={path:tg.auctionPath,requiredKeys:["bids","pageDetail","deviceDetail","floorDetail","auctionDetail","userDetail","adUnitDetails","consentDetail","pmacDetail","extraData","initOptions"],eventType:"auction"};if(this.auctionCache[e].sendAs.includes(o.eventType))return;this.sendData(o,t),this.auctionCache[e].sendAs.push(o.eventType)}catch(e){this.logger.error("PubxAnalytics prepareAuctionSend error:",e),this.logger.remotePageError({code:Y.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}})}}sendData(e,t){try{var o,i;if(!e.requiredKeys.every(e=>!!t[e]))return;let r=((o={protocol:"https",hostname:this.initOptions.hostName||tg.defaultHost,pathname:e.path,search:{auctionTimestamp:t.auctionDetail.timestamp,pubxaiAnalyticsVersion:"v2.3.0",prebidVersion:this.prebidInstance.version.split("v")[1],pubxId:this.initOptions.pubxId}}).protocol||"http")+"://"+(o.host||o.hostname+(o.port?`:${o.port}`:""))+(o.pathname||"")+(o.search?`?${i=o.search||{},Object.keys(i).map(e=>Array.isArray(i[e])?i[e].map(t=>`${e}[]=${t}`).join("&"):`${e}=${i[e]}`).join("&")}`:"")+(o.hash?`#${o.hash}`:""),a=Object.fromEntries(e.requiredKeys.map(e=>[e,t[e]])),n=JSON.stringify([a]);fetch(r,{method:"POST",body:n,headers:{"Content-Type":"text/plain"}})}catch(e){this.logger.error("PubxAnalytics sendData error:",e),this.logger.remotePageError({code:Y.PUBX_ANALYTICS_ERROR,payload:{name:e.name,message:e.message}})}}setupPrebidListeners(){this.prebidInstance.onEvent("auctionEnd",e=>{this.track(Z.AUCTION_END,e)}),this.prebidInstance.onEvent("bidResponse",e=>{this.track(Z.BID_RESPONSE,e)}),this.prebidInstance.onEvent("bidRejected",e=>{this.track(Z.BID_REJECTED,e)}),this.prebidInstance.onEvent("bidTimeout",e=>{this.track(Z.BID_TIMEOUT,e)}),this.prebidInstance.onEvent("bidWon",e=>{this.track(Z.BID_WON,e)})}logMissedEvents(){let e=this.prebidInstance.getEvents().filter(e=>tp.includes(e.eventType));e.forEach(e=>{this.track(e.eventType,e.args)})}initialise(){this.logMissedEvents(),this.setupPrebidListeners()}}tg.defaultHost="api.pbxai.com",tg.auctionPath="/analytics/auction",tg.winningBidPath="/analytics/bidwon",o().pbNsKeys.split(",").map(e=>D(e)).forEach(e=>{e1(e),function(e,t=!1){e.pbNamespace.que.push(()=>{var o;let i=null===(o=window.__pubx__)||void 0===o?void 0:o.logger;try{let o=e.pbNamespace,r=e.pbNamespace.version.replace("v","");if(t){null==i||i.debug("Prebid Analytics is enabled for Prebid version: ",r),a(e);return}null==i||i.debug("Pubx Analytics is enabled for Prebid version: ",r);let n={pubxId:e.pubxId,samplingRate:e.samplingRate},d=new tg(n,o,e);d.initialise()}catch(e){null==i||i.error("Error enabling analytics: ",e)}})}(e),U(e),G(e,B),j(e)})})();